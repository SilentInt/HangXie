# 介绍

本文档为河北工业大学23届CUADC对地侦查与打击项目组赛后技术方案总结。

BY:赵桂龙
QQ:2990041462

# 现有方案

最后上场的方案抛弃了自动飞行控制与投放控制，采用了固定航线，固定投放点，视觉辅助侦查.

提取靶标->矫正靶标->将靶标展示在地面端

通过查找靶标颜色，得到可能存在靶标的区域
即对颜色做最小外接矩形，并将矩形长宽扩大一定值

提取矩形所在区域，命名为box，假定图像边缘均为背景，中心区域为靶标。
对图像采用分水岭算法处理，经实验，可较好的分离出靶标和背景。

记提取出的靶标为target，根据靶标色块分布对靶标方向进行矫正。
以靶标长边为分割，红色/蓝色区域较大的一半为上半，由此确定靶标方向。
靶标矫正因可能存在的天井遮挡等问题，存在不小的失效可能。

将提取出的靶标插入image_queue，
使用Python内置的http.server实现一个Web页面，地面端设备（平板）和天空端（树莓派）在同一网段下，访问指定ip地址和端口，实现将消息队列内的图片以瀑布流的形式展示在地面段上。

# 探索过但是存在问题的方案

## 靶标查找的准确率不够

纯视觉方案已死，直接上YOLO。
可以用上述视觉方案判断图像中是否存在靶标，再决定要不要让yolo做识别。
看明年的硬件性能，足够的话就不再需要预先过滤了。


## 靶标矫正的正确度不够

见上述

## 数字区域提取不准确

假设target边缘均为非数字区域，根据比例标定靶标数字区域位置，再次使用分水岭算法得到靶标数字区域，记为num。
该方案会受到拍摄光线、拍摄角度的影响，提取出的num区域也可能带有周围颜色部分。

## 数字识别

尝试了使用text_renderer配合OpenCV做后处理生成数据集，添加了黑体与思源黑体。
使用LeNet5训练数字识别模型。
经实验，该方案受到噪声的干扰较大，无法很好的满足要求。

## 航线切换

采用MavSDK通过MavLink与Ardupilot进行通信，摄像头拍摄色卡进行选择航线的方案，在场地测试时，飞控接收到上传航线操作后会触发RTL，未解决，建议更换ROS对飞控进行控制。

## 位置解算

飞机上摄像头搭载单轴云台（横滚方向）对正下方进行拍摄，结合OpenCV识别程序得到靶标在图像中的坐标，通过MavSDK从飞控获取的GPS位置数据，飞机当前朝向等信息，结合靶标短边长度为1m已知，将图像上的坐标准换成正北方向坐标轴坐标，再通过haversine算法得到靶标经纬度，添加滤波算法得到最终坐标。
该思路未测试过。
